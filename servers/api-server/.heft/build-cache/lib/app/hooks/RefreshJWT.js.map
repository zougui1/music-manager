{"version":3,"file":"RefreshJWT.js","sourceRoot":"","sources":["../../../src/app/hooks/RefreshJWT.ts"],"names":[],"mappings":";;;AAAA,qCAA0F;AAE1F,oCAAyC;AAElC,MAAM,UAAU,GAAG,GAAkB,EAAE;IAC5C,OAAO,WAAI,CAAC,GAAG,CAAC,EAAE;QAChB,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE;YACb,OAAO;SACR;QAED,OAAO,KAAK,EAAE,QAAsB,EAAE,EAAE;YACtC,IAAI,gCAAyB,CAAC,QAAQ,CAAC,EAAE;gBACvC,OAAO;aACR;YAED,MAAM,QAAQ,GAAG,qBAAa,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;YACzC,IAAI,cAAc,GAAG,CAAC,cAAc,CAAC,CAAC;YACtC,MAAM,sBAAsB,GAAG,QAAQ,CAAC,SAAS,CAAC,+BAA+B,CAAC,CAAC;YAEnF,IAAI,sBAAsB,EAAE;gBAC1B,cAAc,GAAG,cAAc,CAAC,MAAM,CAAC,sBAAsB,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC;aAC3E;YAED,QAAQ;iBACL,SAAS,CAAC,cAAc,EAAE,QAAQ,CAAC;iBACnC,SAAS,CAAC,+BAA+B,EAAE,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;QAC3E,CAAC,CAAA;IACH,CAAC,CAAC,CAAC;AACL,CAAC,CAAA;AAxBY,QAAA,UAAU,cAwBtB","sourcesContent":["import { Hook, HookDecorator, HttpResponse, isHttpResponseServerError } from '@foal/core';\n\nimport { generateToken } from '../utils';\n\nexport const RefreshJWT = (): HookDecorator => {\n  return Hook(ctx => {\n    if (!ctx.user) {\n      return;\n    }\n\n    return async (response: HttpResponse) => {\n      if (isHttpResponseServerError(response)) {\n        return;\n      }\n\n      const newToken = generateToken(ctx.user);\n      let exposedHeaders = ['Access-Token'];\n      const originalExposedHeaders = response.getHeader('Access-Control.Expose-Headers');\n\n      if (originalExposedHeaders) {\n        exposedHeaders = exposedHeaders.concat(originalExposedHeaders.split(','));\n      }\n\n      response\n        .setHeader('Access-Token', newToken)\n        .setHeader('Access-Control-Expose-Headers', exposedHeaders.join(', '));\n    }\n  });\n}\n"]}